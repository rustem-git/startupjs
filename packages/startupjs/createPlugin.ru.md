# Как создать свой плагин

Создайте файл плагина с именем myPlugin.plugin.js (вместо myPlugin вы можете указать любое другое название файла, но обязательно должна присутствовать вторая часть названия файла ".plugin.js"). В примере ниже мы показали, что в себе содержит файл с плагином. Ознакомьтесь с комментариями в коде.

```js
import { createPlugin } from 'startupjs/registry'

// плагин создается с помощью функции createPlugin
export default createPlugin({
  // name - уникальное название плагина
  name: 'my-plugin',
  // enabled указывает, включен плагин или нет.
  // Если его значение false, то плагин считается отключенным и его
  // функциональность не будет активирована в приложении.
  enabled: true,
  // client, isomorphic, server - среда выполнения
  client: (pluginOptions) => ({
    // Здесь может быть добавлена реализация клиентских хуков. Например,
    // для наглядности добавим хук customFormInputs
    customFormInputs: () => ({
      // Код. Детальнее как работают этот и другие хуки мы рассмотрим позже
    })
  }),
  server: (pluginOptions) => ({
    // Здесь может быть добавлена реализация серверных хуков. Например,
    // для наглядности добавим хук api
    api: (expressApp) => {
      expressApp.get('/api/your-uniq-path', async (req, res) => {})
      expressApp.post('/api/your-uniq-path', async (req, res) => {})
    }
  }),
  isomorphic: (pluginOptions) => ({
    // Здесь может быть добавлена реализация изоморфных хуков
  }),
})
```

Добавьте информацию об этом файле в раздел `exports` файла `package.json` в соответствии с его названием, например, `myPlugin.plugin.js`, чтобы он автоматически загружался в ваше приложение. Если плагины лежат в отдельной папке, то необходимо учесть путь:

```json
"exports": {
  "./plugin.js": "./plugin.js",
  "./plugins/myPlugin.plugin.js": "./plugins/myPlugin.plugin.js"
}
```

Для того, чтобы передать параметры в плагин (pluginOptions в нашем примере), вам нужно указать их в файле startupjs.config.js, который находится в корневой папке вашего проекта. Для этого сначала импортируем плагины в этот файл, затем указываем параметры для каждого плагина в разделе plugins, где ключами являются имена плагинов, а значениями - объекты с параметрами для серверных, клиентских и изоморфных хуков:

```js
  // импортируем плагины из соответствующих файлов
  import myPlugin from './plugins/myPlugin.plugin.js'
  import somePlugin from './plugins/somePlugin.plugin.js'

  export default {
    plugins: {
      // Здесь myPlugin, somePlugin - названия плагинов, под которыми мы их импортировали
      [myPlugin]: {
        // Здесь указываем все, что касается серверных хуков
        server: {
          // Список параметров для серверных хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someServerOption: 'some value'
        },
        // Здесь указываем все, что касается клиентских хуков
        client: {
          // Список параметров для клиентских хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someClientOption: 'some value'
        },
        // Здесь указываем все, что касается изоморфных хуков
        isomorphic: {
          // Список параметров для изоморфных хуков. Они будут храниться в pluginOptions и доступны в хуках.
          someIsomorphicOption: 'some value'
        }
      },
      [somePlugin]: {
        // Eсли параметры для client не нужны, то можно просто не указывать этот блок. Аналогично с server и isomorphic
        // Для этого плагина, например, нам нужно передать опции только для серверных хуков.
        server: {
          someOption: 'Hello from server!'
        }
      },
      // Здесь вы можете добавить свой плагин со списком необходимых параметров.
    }
  }
```

### Order (опционально)

Опционально в createPlugin Вы можете добавить order - порядок исполнения плагинов, указав "группу" исполнения.
Помимо указанных ниже "групп", вы так же можете использовать варианты 'before группа' и 'after группа'.

Возможные варианты групп в порядке их исполнения:

```js
  'first',
  'root',
  'session',
  'auth',
  'api',
  'pure', // для чистых плагинов startupjs, которые не зависят от наличия 'ui' или 'router'
  'ui', //  для плагинов, которые зависят от 'ui'
  'router', // для плагинов, которые зависят от 'router'
  'default', // группа по умолчанию, которая выполняется после всех остальных
  'last'
```

Например,

```js
export default createPlugin({
  name: 'my-plugin',
  order: 'ui',
  client: (pluginOptions) => ({
    // ...
  })
})
```

### For (опционально)

Свойство for указывает, для какого модуля создается этот плагин. Например, если вы создаете плагин для модуля admin, вы можете указать for: 'admin'. [Детальнее про модули можно почитать тут](https://github.com/startupjs/startupjs/blob/master/packages/startupjs/aboutModules.ru.md)

Например,

```js
export default createPlugin({
  name: 'my-plugin',
  for: 'admin',
  client: () => ({
    // ...
  })
})
```

Когда вы создаете плагин с указанием for: 'admin', StartupJS автоматически подключает этот плагин к модулю с именем "admin".
Если for не указан, то модулем по умолчанию станет непосредственно платформа startupjs.


## Читайте дальше:
- [Хуки для плагинов](https://github.com/startupjs/startupjs/blob/master/packages/startupjs/hooks.ru.md)
